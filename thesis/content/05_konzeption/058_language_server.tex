\section{Language Server}\label{section:konzeption:language-server}

% \begin{note}
%     \textbf{Notizen:}
%     \begin{itemize}
%         \item Erwähnung von \autoref{requirement:Language Server} und \autoref{requirement:Language Server: CrossLab-Kompatibilität}
%         \item Beschreibung der CrossLab-Services + Klassendiagramm
%         \item Konzept für die Bereitstellung von Debuggern als Laborgeräte
%         \item Beschreibung der Einbindung in die betrachtete Experimentkonfiguration
%         \item (Beschreibung möglicher Einstellungen?)
%     \end{itemize}
% \end{note}

\begin{figure}[tbp]
    \centering
    \resizebox{\textwidth}{!}{
        \begin{tikzpicture}
            \begin{class}[text width=7.5cm]{LanguageServerServiceProducer}{0,0}
                \operation{+ sendMessageLSP()}
                \operation{+ onReadFile()}
                \operation{+ onInitialize()}
                \operation{+ onMessageLSP()}
                \operation{+ onFilesystemEvent()}
            \end{class}
            \begin{class}[text width=7.5cm]{LanguageServerServiceConsumer}{8,0}
                \operation{+ initialize()}
                \operation{+ readFile()}
                \operation{+ sendMessageLSP()}
                \operation{+ sendFilesystemEvent()}
                \operation{+ onMessageLSP()}
            \end{class}
        \end{tikzpicture}
    }
    \caption{Klassendiagramm Language Server Service}
    \label{figure:klassendiagramm-language-server-service}
\end{figure}

Nach \autoref{requirement:Language Server} soll die Anbindung von Language Servern an die IDE ermöglicht werden. Dafür soll laut Unteranforderung (a) ein CrossLab-Service für die Bereitstellung und Nutzung von Language Servern entwickelt werden. Dieser soll nach Unteranforderung (b) von der IDE für die Nutzung von Language Servern verwendet werden. Bevor die konzipierten CrossLab-Services vorgestellt werden, wird zunächst ein kurzer Überblick über das \textit{\ac{LSP}} \cite{noauthor_language-server-protocol_nodate} sowie die Herausforderungen für die Anbindung an die IDE gegeben.

% sollte wahrscheinlich eher in Grundlagen erklärt werden da es bereits in den Anforderungen erwähnt wird
Das \acl{LSP} ist ein von Microsoft \cite{noauthor_microsoft_nodate} entwickeltes Protokoll zur Kommunikation zwischen einem \textit{Language Client} und einem \textit{Language Server}. Language Server ermöglichen Editorfunktionen, wie z.B. Code-Vervollständigung, Code-Navigation und Refactoring für ausgewählte Programmiersprachen. Language Clients sind meist als Teil eines Code Editors implementiert und sind mit allen Language Servern kompatibel. Das Protokoll ist für die lokale Kommunikation zwischen einem Language Client und einem Language Server entworfen, d.h. es wird angenommen, dass beide auf demselben System ausgeführt werden. Dies hat zur Folge, dass für den verteilten Anwendungsfall entsprechende Vorkehrungen getroffen werden müssen um die Funktionalität zu gewährleisten. So muss es dem Language Server ermöglicht werden auf die Dateien des Remote-Systems zugreifen zu können und umgekehrt. Es gibt Language Server, die den Quellcode lokal verarbeiten bzw. sogar kompilieren und basierend auf diesen Ergebnissen Antworten an den Language Client zurücksenden. Dazu werden Dateien auf dem Server verwendet, auf welche der Language Client ggf. Zugriff benötigt. Unter Betrachtung dieser Herausforderungen wird im Folgenden der \textit{Language Server Service} vorgestellt.

\autoref{figure:klassendiagramm-language-server-service} zeigt ein Klassendiagramm für den Language Server Service. Die Funktion \texttt{initialize()} des Language Server Service Consumer kann für die Initialisierung eines Language Servers verwendet werden. Dabei wird der aktuelle Ordner des Nutzers und dessen Pfad bzw. URL sowie ggf. Konfigurationsoptionen für die Initialisierung des Language Server übergeben. Dadurch wird ein enstprechendes \texttt{Initialize}-Event von dem verbundenen Language Server Service Producer ausgelöst. Über entsprechende Event Handler kann dieses abgefangen und für die Initialisierung des Language Server verwendet werden. Dabei kann u.a. der übergebene Ordner in dem lokalen Dateisystem hinterlegt werden und der Language Server mit den angegebenen Konfigurationsoptionen gestartet werden. Die übergebene URL des Ordners kann zur Umschreibung von URLs innerhalb der Nachrichten des \ac{LSP} verwendet werden. Diese unterscheiden sich ggf. zwischen den Systemen des Language Server Service Producer und des Language Server Service Consumer. Nachdem der Language Server initialisiert wurde wird eine Antwort an den Language Server Service Consumer gesendet. Dateisystem-Events innerhalb des verwendeten Ordners auf der Seite des Language Server Service Consumer müssen an den Language Server Service Producer mithilfe der Funktion \texttt{sendFilesystemEvent()} gesendet werden. Diese umfassen die Erstellung und Löschung von Dateien und Ordnern sowie Änderungen von Dateien. Die Behandlung dieser Dateisystem-Events kann über entsprechende Event Handler erfolgen. Sobald die Initialisierung erfolgt ist kann das \ac{LSP} mit den Konfigurationsoptionen gestartet werden. Der Austausch der \ac{LSP} Nachrichten erfolgt dabei über die Funktion \texttt{sendMessageLSP()}. Zur Behandlung dieser Nachrichten können Event Handler für die entsprechenden \texttt{MessageLSP}-Events registriert werden. Da der Nutzer ggf. Zugriff auf die lokalen Dateien des Language Server benötigt, z.B. für die Betrachtung von Bibliotheksdateien, ermöglicht der Language Server Service Consumer das lesen von Dateien über die Funktion \texttt{readFile()}. Das dadurch ausgelöste \texttt{ReadFile}-Event kann auf der Seite des Language Server Service Producer durch einen entsprechenden Event Handler behandelt werden.

Die betrachtete Experimentkonfiguration wird zunächst um ein weiteres Laborgerät erweitert. Dieses stellt einen Language Server über einen entsprechenden Language Server Service Producer bereit. Die IDE wird um einen Language Server Service Consumer erweitert. Die beiden Laborgeräte werden dann über den Language Server Service miteinander verbunden, wodurch die IDE die Funktionen des bereitgestellten Language Server verwenden kann.